{% load staticfiles %}
    <div class="row-fluid right_new_post">
        <div class="span12">
            <form method="POST" id="id_form_quick_post">
                <select id="select0" class="new_post_to select2 select_all_list" name="new_post_to" multiple>
                    
                </select>
                <!-- <textarea class="new_post_to" placeholder="To " rows="1"></textarea> -->
                <textarea class="new_post atwho_at_config  resize_textarea" name="new_post" placeholder="Quick Post" rows="3"></textarea>

                <a class="pull-right btn primary new_post_submit" href="javascript:void(0)" data-loading-text="Posting ..." data-complete-text="Posted"> Create Post </a>
            </form>
       </div>
    </div>
    <hr />
    <div class='row-fluid right_search'>
        <div class='contact_searchbar searchbar span12'>  
            <input class='input' id='rightbar_search_input' type='text' placeholder=' Search for stuff ...'>
            
        </div>
    </div>
    <div class="row-fluid right_data">
        <div class="span12 right_data_inner">
            <div class="row-fluid data_item template">
                <div class="pic">
                    <img class="profile_dp" src="{% static 'img/temp/profile.jpg' %}">
                </div>
                <div class="text">
                </div>
            </div>
            {% comment %}
                For ajax loading ... use this template
                {% with name="template" %}
                    {% include "modules/right_data_item.html" %}
                {% endwith %}
            {% endcomment %}
        </div>
    </div>
    

<style>
.rightbar .right_new_post {
}
.rightbar .right_new_post .new_post_to {
    width : 100%;
    margin : 0.5em;
}
.rightbar .right_new_post .new_post {
    width : 100%;    
    margin : 0.5em;
}
.rightbar .right_new_post .new_post_submit {
    padding : 0.5em 2em;

}
.rightbar .right_data {
    margin-left : 1em;
}
.rightbar .right_data .data_item {
    color: #141823;
    height : 30px;
    border-top: 1px solid transparent;
    border-bottom: 1px solid transparent;
}
.rightbar .right_data .data_item:hover,
.rightbar .right_data .data_item.active {
    background-color : #dcdcde;
    border-top: 1px solid #c0c0c1;
    border-bottom: 1px solid #c0c0c1;
}
.rightbar .right_data .data_item .pic {
    float:left;
    margin : 0px 5px;
}
.rightbar .right_data .data_item .pic,
.rightbar .right_data .data_item .pic img {
    margin-top : 1px;
    height : 26px;
}
.rightbar .right_data .data_item .text {
    margin-left : 34px;
    padding-left : 6px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    line-height: 30px;

}
.rightbar .right_search {
    width: 100%;
    margin :0.5em;
}
.contact_searchbar input {
    height : 14px;
    width : 100%;    
    padding : 4px;
    border: 1px solid #D4DAE8;
    margin : 0px;
}
.data_item.template {
    display : none;
}
</style>

<script>
    function dajax_quick_post(data) {
        $('#id_form_quick_post').removeData("clicked")
        //$el = $("#id_form_quick_post .new_post_submit")
        //$el.button("done")
        //setTimeout(function() {
        //    $el.button("reset")
        //    $el.closest("form").find("input").val("")
        //    $el.closest("form").find("select").val("")
        //}, 3000)
    }
    function right_search(query, data, search_key) {
        var item, _i, _len, _results;
        _results = [];
        for (_i = 0, _len = data.length; _i < _len; _i++) {
            item = data[_i];
            if (~item[search_key].toLowerCase().indexOf(query)) {
                _results.push(item);
            }
        }
        items = _results;
        
        var item, _i, _len, _results;
        if (!query) {
            return items;
        }
        _results = [];
        for (_i = 0, _len = items.length; _i < _len; _i++) {
            item = items[_i];
            item.atwho_order = item[search_key].toLowerCase().indexOf(query);
            if (item.atwho_order > -1) {
                _results.push(item);
            }
        }
        return _results.sort(function(a, b) {
            return a.atwho_order - b.atwho_order;
        });
    }
    $( document ).ready(function() {            
        $("#id_form_quick_post .new_post_submit").click(function() {
            $el = $(this)
            if ( $('#id_form_quick_post').data("clicked") ) {
                return
            }
            $('#id_form_quick_post').data("clicked", "yes")
            Dajaxice.apps.walls.quick_post(dajax_quick_post, {
                'post_form': $('#id_form_quick_post').serialize(true) 
            })
            //$el.button("loading")
        });

        $('.select2').select2();

        $(".right_search .searchbar input").keyup( function (e) {
            el = this; $el = $(el);
            if ( !all_list ) {
                console.log("Atwho lists not loaded yet.")
                return
            }
            search_list = right_search($el.val(), all_list, "name")
            
            $parent = $el.closest(".rightbar").find(".right_data_inner")
            $template = $parent.find(".template.data_item")
            console.log($parent)
            $parent.find(".data_item").not(".template").remove()
            for ( var i = 0; i < Math.min(10, search_list.length); i++ ) {
                $new_element = $template.clone().removeClass("template")
                $new_element.find(".text").html(search_list[i].name + " <small class='muted'> " + search_list[i].small + "</small>")
                $new_element.data("id", search_list[i].id)
                $parent.append($new_element)
            }
        })
        
    });
</script>