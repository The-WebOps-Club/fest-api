<!DOCTYPE html>
{% load staticfiles %}
{% load compress %}
<html lang="en">

<head>
	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="iitm, team, robocon, robotics, auto, autonomous, bot, manual, iit, madras, mit, pune, abu, dd, doordarshan, india, chennai, shaastra, iitmadras, 2015">
    <meta name="description" content="Shaastra - ERP. The gateway to administrating Shaastra ( techfest of IIT Madras ) with ease.">
    <meta name="author" content="Abdeali JK">

    <meta property="og:title" content="Shaastra ERP | 2015">
    <meta property="og:type" content="Techfest">
    <meta property="og:url" content="http://erp.shaastra.org">
    <meta property="og:image" content="{% static 'img/logo/logo_blue.png' %}">
    <meta property="og:site_name" content="Shaastra ERP | 2015">
    <meta property="og:description" content="Shaastra - ERP. The gateway to administrating Shaastra ( techfest of IIT Madras ) with ease.">
    
    <title>{% block title %} {{ FEST_NAME }} {% endblock %}</title>

    {% if DEBUG %}
        <script>
            localStorage.clear(); /* kill cache */
        </script>
    {% endif %}
    
    {% compress css %}
    <!-- Include stylesheets here -->
    <link href="{% static 'css/erp-bootstrap.css' %}" rel="stylesheet" media="screen">
    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link href="{% static 'css/styles.css' %}" rel="stylesheet" media="screen">
    <link href="{% static 'css/jquery.atwho.css' %}" rel="stylesheet" media="screen">
    
    <link href="{% static 'css/icons-color.css'%}" rel="stylesheet" media="screen">
    <!--<link rel="icon" type="image/x-icon" href="{% static 'img/favicon.ico' %}">-->
    {% endcompress %}

    {% compress js %}
    <script type="text/javascript" src="{% static 'js/jquery-1.11.0.js' %}"></script>
    {% endcompress %}

    <link rel="shortcut icon" href="{% static 'img/fest_pics/favicon.ico' %}">
    
    {% compress css %}{% block extra_css %}{% endblock %} {% endcompress %}

    {% compress js %}
    {% if not DEBUG %}
    <script type="text/javascript">
        (function(i, s, o, g, r, a, m) {
            i["GoogleAnalyticsObject"] = r;
            i[r] = i[r] || function() {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, "script", "//www.google-analytics.com/analytics.js", "ga");

        //ga("create", "", "");
        //ga("send", "pageview");
    </script>
    {% endif %}
    {% endcompress %}
</head>

<body>

    {% block topbar %} 
    	{% include 'base/topbar.html' %} 

	    {% include "base/notifs.html" %}
	    {% comment %}
	    	{% include "base/messages.html" %}
	    	{% include "base/users.html" %}
	    {% endcomment %}
	    {% include "base/settings.html" %}

    {% endblock %}

    <div class="container-fluid below_topbar">
        {% block full_content %}
        <div class="row-fluid">
            {% block left_content %} 
                <div class="span2 offset1 sidebar fixedbar" >
                    {% block sidebar %} 
                	   {% include 'base/sidebar.html' %}
                    {% endblock %}
                </div>
            
	            <div id="main_body_content" class="span6 main_body">
	                {% block content %} {% endblock %}
	            </div>
            {% endblock %}
            <div id="rightbar" class="span2 rightbar fixedbar">
                {% block rightbar %} 
                    {% include 'base/rightbar.html' %}
                {% endblock %}
            </div>
        </div>
        {% endblock %}
    </div>


    {% compress js %}
    <script type="text/javascript" src="{% static 'js/erp-bootstrap-twipsy.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/erp-bootstrap-alerts.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/erp-bootstrap-buttons.js' %}"></script>
    <!-- <script type="text/javascript" src="{% static 'js/erp-bootstrap-dropdown.js' %}"></script> -->
    <script type="text/javascript" src="{% static 'js/erp-bootstrap-popover.js' %}"></script>
    <!-- <script type="text/javascript" src="{% static 'js/erp-bootstrap-modal.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/erp-bootstrap-scrollspy.js' %}"></script> -->
    <script type="text/javascript" src="{% static 'js/erp-bootstrap-affix.js' %}"></script>
    
    <!-- <script type="text/javascript" src="{% static 'js/prefixfree.min.js' %}"></script> -->
    
    <script type="text/javascript" src='{% static "dajax/jquery.dajax.core.js" %}'></script>
    {% load dajaxice_templatetags %} {% dajaxice_js_import %} 
    
    
    <script src='{% static "js/select2/select2.js" %}'/>
        
    <script type="text/javascript" src='{% static "js/jquery.caret.js" %}'></script>
    <script type="text/javascript" src='{% static "js/jquery.atwho.js" %}'></script>
    
    <script type="text/javascript" src='{% static "js/autocomplete.js" %}'></script>

    <!--<script type="text/javascript" src='{% static "js/gravatar.js" %}'></script>-->

    <script type="text/javascript" src='{% static "js/jquery.autosize.js" %}'></script>
    {% endcompress %}

    {% compress css %}
    <link rel='stylesheet' href='{%static "css/select2.css"%}'/>
    {% endcompress %}

    {% compress js %}
    {% block extra_js %}{% endblock %}
    <script>
    	site_url = "{{ SITE_URL }}"
    	static_url = "{{ STATIC_URL }}"
        function truncate(string, l){
            if (string.length > l)
                return string.substring(0, l)+'...';
            else
                return string;
        };
		function show_video_preview(i, v) {
            var $v = $(v)
            var service = $v.data("service")
            var id = $v.data("video-id")
            if ( service == "youtube" ) {
                var url = "http://gdata.youtube.com/feeds/api/videos/" + id + "?v=2&alt=jsonc"
                $.getJSON(url, function(json) {
                    console.log(json)
                    my_json = json
                    $v.find(".left").append("<img src='" + json.data.thumbnail.sqDefault + "' width='100%' height='auto' />")
                    $v.find(".right").append("<h5 class='title'>" + json.data.title + "</h5>")
                        .append("<p class='desc'>" + json.data.description + "</p>")
                });
    
            } else if ( service == "vimeo") {

            }
            $v.removeClass("video_render")
        }

        function display_pic(el, size) {
			$el = $(el)
			$.each($el, function(i, v) {
				var $v = $(v)
				var fbid = $.trim($v.data("fbid"))
				var size = size || $v.data("size") || 60
				if ( fbid.length > 2  ) {
					var pic_src = "http://graph.facebook.com/" + fbid +  "/picture?height=" + size + "&width=" + size;
			        $v.prop("src", pic_src);

				} else {
					if ( ! $v.data("id") || ! atwho_user_list ) {
						// As some places have these in templates
						return
					} else {
						Dajaxice.apps.users.get_info(function(data) {
					    	var $v = $(v);

					    	if ( ! data["fbid"] ) {
					    		data["fbid"] = "Shaastra"
					    	}

					    	var pic_src = "http://graph.facebook.com/" + data["fbid"] +  "/picture?height=" + size + "&width=" + size;
					       	$v.prop("src", pic_src);
					        //var filter_users = $.grep(atwho_user_list, function(a) { return a.id == data["id"] } )
							//filter_users[0].fbid = data["fbid"];
							$v.data("fbid", data["fbid"])
						}, {"id" : $v.data("id") } )
					}
				}
			})
		}
        function hide_popups() {
	            $(".userButton").popover("hide") 
	            $(".messageButton").popover("hide")
	            $(".notifButton").popover("hide") 
	            $(".settingButton").popover("hide") 
	    }
	
        function on_dom_change() {
            $(".resize_textarea").autosize()
            display_pic($(".display_pic"))
            if ( ! ( typeof at_config_file === "undefined" ) )
            	$('.atwho_at_config').atwho(at_config_file)
            if ( ! ( typeof at_config === "undefined" ) )
            	$('.atwho_at_config').atwho(at_config)
            $.each($(".video_comment.video_render"),show_video_preview)
        }        
        $( document ).ready(function() {
            $(".below_topbar").click(hide_popups)
    		$(".searchbar").click(hide_popups)

            var $win = $(window), $doc = $(document);
            $win.scroll(function(){
                $(".fixedbar").css({
                    "margin-top" : $doc.scrollTop() + "px",
                })
            });
            
            get_autocomplete_lists("{% static 'json/user_list.json' %}", "{% static 'json/subdept_list.json' %}", "{% static 'json/dept_list.json' %}");
          
    	})
        $(window).bind('load', function () {
            $(".resize_textarea").autosize()
            on_dom_change()
        })
    </script>
    {% endcompress %}
</body>

</html>
