
{% extends 'base/base.html' %}
{% load staticfiles %}

{% block title %} {{ FEST_NAME }} {% endblock %}

{% block content %}
   <h1>File Manager</h1>
   <button class="btn" onclick="createPicker()">Open File Manager</button>
<a id="doc_link" style="display:none;" href="http://example.com" class="fancybox fancybox.iframe"></a>
{% endblock %}

{% block extra_css %}
{{ block.super }}
<style type='text/css'>
</style>
{% endblock %}


{% block extra_js %}
{{ block.super }}
<script type="text/javascript">

    // Use the Google API Loader script to load the google.picker script.
    function loadPicker() {
      gapi.load('picker', {'callback': createPicker});
    }

    // Create and render a Picker object 
    function createPicker() {
      var docsView = new google.picker.DocsView()
      .setIncludeFolders(true) 
      .setParent('{{SETTINGS.GOOGLE_DRIVE_ROOT_FOLDER_ID}}')
      .setSelectFolderEnabled(true);
      var uploadView = new google.picker.DocsUploadView()
            .setIncludeFolders(true);
      var picker = new google.picker.PickerBuilder()
          .enableFeature(google.picker.Feature.MULTISELECT_ENABLED)
          .setOAuthToken('{{token}}')
          .addView(docsView)
          .addView(uploadView)
          .setCallback(pickerCallback)
          .build();
       picker.setVisible(true);
    }

    // A simple callback implementation.
    function pickerCallback(data) {
      if (data.action == google.picker.Action.PICKED) {
        var fileId = data.docs[0].id;
        var fileUrl = data.docs[0].url;
        $('#doc_link').attr('href', fileUrl).click()
        // createPicker()

      }
    }
    </script>
  </head>
  <body>
    <div id="result"></div>

    <!-- The Google API Loader script. -->
    <script type="text/javascript" src="https://apis.google.com/js/api.js?onload=loadPicker"></script>
{% endblock %}
