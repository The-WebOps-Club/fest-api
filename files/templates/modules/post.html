{% load staticfiles %} 
{% load humanize %} 
{% load markdown_deux_tags %}
{% load once %}

{# Remember : "post" and "notification" are keywords used here #}

<div id="post_{{ post.id }}" class="row-fluid" style="">
	{% if forloop.counter0 %} <hr /> 
	{% else %} <div class="" style="height : 30px;"></div>
	{% endif %}
	<div class="news_post span12">
	    <div class="news_left">
	        <img src="{% static 'img/temp/profile.jpg' %}" alt="" class="news_profile">
	    </div>
	    <div class="news_main">
	        <div class="news_head">
	        	{% if not notification %}
	        		<i class="icon-chevron-down pull-right news_post_settings" style="display : none;"></i>
	            	<a class="news_profile_name" href="{% url 'profile' post.by.id %}">{{ post.by.get_full_name }}</a> 
	            	posted on <a href="{% url 'wall' post.wall.id %}">{{ post.wall }}</a> 
	            	<span class="muted small">{{ post.time_created|naturaltime }}</span>
	            {% elif notification %}
	            	<a class="news_profile_name" href="{% url 'profile' post.by.id %}">{{ notification.actor.get_full_name|default:"" }}</a> 
	            	{{notification.verb}} <a href="{% url 'wall' post.wall.id %}">{{ post.wall }}</a> 
	            	<span class="muted small">{{ notification.timestamp|naturaltime }}</span>
	            {% endif %}
	        </div>
	        <div class="news_body">
	            {{ post.description|markdown:"default" }}
	        </div>
	        <div class="news_extra"></div>
	        {% for comment in post.comments.all %}
	            <div id="comment_{{ comment.pk }}" class="news_comment">
	                <div class="news_comment_left">
	                    <img src="{% static 'img/temp/profile.jpg' %}" alt="" class="news_comment_profile">
	                </div>
	                <div class="news_comment_body markdown_remove_p">
	                    <a href="{% url 'profile' comment.by.id %}" class="bold">{{ comment.by.get_full_name }}</a> : {{ comment.description|markdown:"default" }}
	                    <div class="news_comment_info">
	                        {{ comment.time_created|naturaltime }} 
	                        {% if comment.time_updated != comment.time_created %}edited {{ comment.time_updated|naturaltime }}{% endif %}
	                    </div>
	                </div>
	            </div>
	        {% endfor %}
	        <div class="news_comment">
	            <div class="news_comment_left">
	                <img src="{% static 'img/temp/profile.jpg' %}" alt="" class="news_comment_profile">
	            </div>
	            <div class="news_comment_body">
	                <form action="{% url 'create_comment' post.pk %}" method="POST">
	                    {% csrf_token %}
	                    <textarea class="span12 comment_textarea resize_textarea" name="comment" cols="30" rows="1" id="id_new_comment_{{ post.id }}" placeholder="Post your comment here. Ctrl+Enter for next line. Markdown like : *italic* **bold** etc are allowed. Examples @ {{SETTINGS.SITE_URL}}markdown"></textarea>
	                    
	                </form>
	            </div>
	        </div>
	    </div>
	</div>
</div>

{% once post_styles_and_scripts %}
<style>
div.news_post {
	transition-property: background;
	transition-duration: 0.5s;
	transition-timing-function: linear;
}
div.news_post hr {
}
.news_left img.news_profile, .news_left {
    float:left;
    width : 50px;
    height : 50px;
    vertical-align: text-top;
}
.news_main {
    font-size : 14px;
    width : auto;
    line-height : 18px;
    margin-left : 60px;
}
.news_main .news_head {
    margin-bottom : 5px;
}
.news_main .news_profile_name {
    font-weight : bold;
}
.news_comment {
    margin-top : 2px;
    background-color: #EEE;
    padding : 5px;
    display : block;
}
.news_comment .news_comment_left, .news_comment .news_comment_left .news_comment_profile {
    height : 32px;
    width : 32px;
    float : left;
}
.news_comment .news_comment_body {
    font-size : 12px;
    line-height : 15px;
    margin-left : 40px;
    min-height : 32px;
}
.markdown_remove_p > p {
    display : inline;
}
.news_comment .news_comment_body .news_comment_info {
    font-size : 11px;
    line-height : 13px;
    color : #666;
    margin-top : 5px;
}
</style>

<script type="text/javascript">

    $( document ).ready(function() {            
        $(".news_post").mouseover( function() {
            $(this).find(".news_post_settings").show()
        })
        $(".news_post").mouseout( function() {
            $(this).find(".news_post_settings").hide()
        })

		// var emojis = [ "smile", "iphone", "girl", "smiley", "heart", "kiss", "copyright", "coffee", "a", "ab", "airplane", "alien", "ambulance", "angel", "anger", "angry", "arrow_forward", "arrow_left", "arrow_lower_left", "arrow_lower_right", "arrow_right", "arrow_up", "arrow_upper_left", "arrow_upper_right", "art", "astonished", "atm", "b", "baby", "baby_chick", "baby_symbol", "balloon", "bamboo", "bank", "barber", "baseball", "basketball", "bath", "bear", "beer", "beers", "beginner", "bell", "bento", "bike", "bikini", "bird", "birthday", "black_square", "blue_car", "blue_heart", "blush", "boar", "boat", "bomb", "book", "boot", "bouquet", "bow", "bowtie", "boy", "bread", "briefcase", "broken_heart", "bug", "bulb", "person_with_blond_hair", "phone", "pig", "pill", "pisces", "plus1", "point_down", "point_left", "point_right", "point_up", "point_up_2", "police_car", "poop", "post_office", "postbox", "pray", "princess", "punch", "purple_heart", "question", "rabbit", "racehorse", "radio", "up", "us", "v", "vhs", "vibration_mode", "virgo", "vs", "walking", "warning", "watermelon", "wave", "wc", "wedding", "whale", "wheelchair", "white_square", "wind_chime", "wink", "wink2", "wolf", "woman", "womans_hat", "womens", "x", "yellow_heart", "zap", "zzz", "+1", "-1"
	 //   	]
	 	
	    // var emoji_config = {
	    //   at: ":",
	    //   data: $.map(emojis, function(value, i) {
	    //	   return {key: value, name:value};
	    // }),
	    //   tpl:"<li data-value=':${key}:'>${name} <img src='http://a248.e.akamai.net/assets.github.com/images/icons/emoji/${name}.png'  height='20' width='20' /></li>",
	    //   insert_tpl: "<img src='http://a248.e.akamai.net/assets.github.com/images/icons/emoji/${name}.png'  height='20' width='20' />",
	    // }
    

		$(".news_post .comment_textarea")
			.keydown(function(e) {
				e = e || event;
	        	el = this; $el = $(this)
	        	if (e.ctrlKey && e.keyCode == 13) { // Ctrl+Enter pressed
	            	e.preventDefault() // to avoid auto submit of forms
	            } else if (!e.ctrlKey && e.keyCode == 13) { // 
	            	e.preventDefault();
	            }
	            //console.log(e)
			})
			.keyup(function (e) {
	        	e = e || event;
	        	el = this; $el = $(this)
	            if (e.ctrlKey && e.keyCode == 13) { // Ctrl+Enter pressed
	            	$el.add_to_textarea("\n")
	            	setTimeout(function(){$el.trigger("input")}, 10)
	            	e.preventDefault()
	            } else if (!e.ctrlKey && e.keyCode == 13) { // Enter pressed
	            	$el.submit_form()
	                e.preventDefault()
	            } 
	            //console.log(e)
	        })
	        .atwho(at_config) 
	        //.atwho(emoji_config)
    })
</script>
{% endonce %}